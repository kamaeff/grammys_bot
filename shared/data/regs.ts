import {Context} from 'grammy';
import {backBtn} from '../utils/buttons';

const badWordsRegex = new RegExp(
  '(?<![Ð°-ÑÑ‘])(?:(?:(?:Ñƒ|[Ð½Ð·]Ð°|(?:Ñ…Ð¸Ñ‚Ñ€Ð¾|Ð½Ðµ)?Ð²Ð·?[Ñ‹ÑŒÑŠ]|Ñ[ÑŒÑŠ]|(?:Ð¸|Ñ€Ð°)[Ð·Ñ]ÑŠ?|(?:Ð¾[Ñ‚Ð±]|Ð¿[Ð¾Ð°]Ð´)[ÑŒÑŠ]?|(?:\\S(?=[Ð°-ÑÑ‘]))+?[Ð¾Ð°ÐµÐ¸-])-?)?(?:[ÐµÑ‘](?:Ð±(?!Ð¾[Ñ€Ð¹]|Ñ€Ð°Ñ‡)|Ð¿[ÑƒÐ°](?:Ñ†|Ñ‚Ñ))|Ð¸[Ð¿Ð±][Ð°Ðµ][Ñ‚Ñ†Ð´][ÑŒÑŠ]).*?|(?:(?:Ð½[Ð¸ÐµÐ°]|Ñ€Ð°[Ð·Ñ]|[Ð·Ð´]?[Ð°Ð¾](?:Ñ‚|Ð´Ð½[Ð¾Ð°])?|Ñ(?:Ð¼[ÐµÐ¸])?|Ð°[Ð¿Ð±]Ñ‡)-?)?Ñ…Ñƒ(?:[ÑÐ¹Ð¸ÐµÑ‘ÑŽ]|Ð»+Ð¸(?!Ð³Ð°Ð½)).*?|Ð±Ð»(?:[ÑÑ]|ÐµÐ°?)(?:[Ð´Ñ‚][ÑŒÑŠ]?)?|\\S*?(?:Ð¿(?:[Ð¸ÐµÑ‘]Ð·Ð´|Ð¸Ð´[Ð°Ð¾Ðµ]?Ñ€|ÐµÐ´(?:Ñ€(?!Ð¾)|[Ð°Ð¾Ðµ]Ñ€|Ð¸Ðº)|Ð¾Ñ…ÑƒÑŽ)|Ð±Ð»Ñ(?:[Ð´Ð±Ñ†]|Ñ‚Ñ)|[Ð¾Ðµ]Ñ…Ñƒ[ÑÐ¹Ð¸ÐµÑ‘]|Ñ…ÑƒÐ¹Ð½).*?|(?:Ð¾[Ñ‚Ð±]?|Ð¿Ñ€Ð¾|Ð½Ð°|Ð²Ñ‹)?Ð¼(?:Ð°Ð½Ð´(?:[Ð°ÑƒÐµÑ‹Ð¸](?:Ð»(?:Ð¸[ÑÐ·Ñ‰])?[Ð°ÑƒÐµÐ¸])?|Ð¾Ð¹|[Ð°Ð¾]Ð².*?|ÑŽÐº(?:Ð¾Ð²|[Ð°ÑƒÐ¸])?|Ðµ[Ð½Ñ‚]ÑŒ|Ð¸Ñ‰Ð°)|ÑƒÐ´(?:[ÑÐ°Ð¸Ð¾Ðµ].+?|Ðµ?Ð½(?:[ÑŒÑŽÐ¸Ñ]|ÐµÐ¹))|[Ð°Ð¾]Ð»[Ð°Ð¾]Ñ„[ÑŒÑŠ](?:[ÑÐ¸ÑŽÐµ]|[ÐµÑ‘Ð¾]Ð¹))|ÐµÐ»Ð´[Ð°ÑƒÑ‹Ðµ].*?|Ð»Ñ[Ñ‚Ð´]ÑŒ|(?:[Ð½Ð·]Ð°|Ð¿Ð¾)Ñ…)(?![Ð°-ÑÑ‘])',
  'i',
);

export const detectBadWords = async ({
  ctx,
  msg_id,
}: {
  ctx: Context;
  msg_id: number;
}) => {
  if (!ctx.msg || !ctx.msg.text || !ctx.chat?.id) return false;

  if (badWordsRegex.test(ctx.msg?.text)) {
    await ctx.api.deleteMessage(ctx.chat.id, msg_id - 1);
    await ctx.api.deleteMessage(ctx.chat.id, msg_id);
    return ctx.reply('ðŸ‘¹ <b>Oi-Oi! Bad word!</b>', {
      parse_mode: 'HTML',
      reply_markup: backBtn,
    });
  }
};
